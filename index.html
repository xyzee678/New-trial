<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Goal Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .date-time {
            text-align: right;
            font-size: 0.9em;
            color: #666;
        }
        
        .section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        h1, h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        h2 {
            color: #3498db;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: middle;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        tr.sub-goal {
            background-color: #f9f9f9;
        }
        
        input[type="text"], 
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            white-space: nowrap;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .button-danger {
            background-color: #e74c3c;
        }
        
        .button-danger:hover {
            background-color: #c0392b;
        }
        
        .button-success {
            background-color: #2ecc71;
        }
        
        .button-success:hover {
            background-color: #27ae60;
        }
        
        .button-secondary {
            background-color: #95a5a6;
        }
        
        .button-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .button-small {
            padding: 4px 8px;
            font-size: 12px;
            min-width: 30px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .progress-input {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .progress-input input {
            flex: 1;
            max-width: 60px;
        }
        
        .status-pending {
            color: #f39c12;
            font-weight: 500;
        }
        
        .status-in-progress {
            color: #3498db;
            font-weight: 500;
        }
        
        .status-completed {
            color: #2ecc71;
            font-weight: 500;
        }
        
        .status-overdue {
            color: #e74c3c;
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        
        .log-goal {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .log-details {
            color: #666;
        }
        
        .log-timestamp {
            color: #95a5a6;
            font-size: 0.8em;
        }
        
        .progress-bar-container {
            width: 100%;
            background-color: #ecf0f1;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .progress-bar {
            height: 6px;
            background-color: #3498db;
            border-radius: 4px;
        }
        
        .expand-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0 5px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .time-remaining {
            font-size: 0.9em;
            color: #666;
        }
        
        .positive {
            color: #2ecc71;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .progress-rank {
            font-weight: 600;
            text-align: center;
        }
        
        .rank-1 { color: #2ecc71; }
        .rank-2 { color: #27ae60; }
        .rank-3 { color: #3498db; }
        .rank-4 { color: #f39c12; }
        .rank-5 { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Smart Goal Tracker</h1>
        <div class="date-time">
            <div id="currentDate">Today's Date: Loading...</div>
            <div id="currentTime">Current Time: Loading...</div>
        </div>
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="tracker">Goal Tracker</div>
        <div class="tab" data-tab="logs">Progress Logs</div>
    </div>
    
    <div class="tab-content active" id="tracker">
        <div class="section">
            <table id="goalTable">
                <thead>
                    <tr>
                        <th>Goal Name</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Follow-up Date</th>
                        <th>Current Progress</th>
                        <th>Required Progress</th>
                        <th>Unit</th>
                        <th>Repetition</th>
                        <th>End Target</th>
                        <th>Available Time</th>
                        <th>Time Remaining</th>
                        <th>Status</th>
                        <th>Progress Rank</th>
                        <th>Last Updated</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be added dynamically -->
                </tbody>
            </table>
            
            <div class="button-group">
                <button id="addGoalBtn" class="button-success">➕ Add New Goal</button>
                <button id="exportDataBtn" class="button-secondary">📤 Export Data</button>
                <button id="importDataBtn" class="button-secondary">📥 Import Data</button>
                <input type="file" id="importFileInput" accept=".json" class="hidden">
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="logs">
        <div class="section">
            <h2>Progress Logs</h2>
            <div id="progressLogContainer"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize with sample data
            let goals = [
                {
                    id: 1,
                    name: "Walking",
                    startDate: "2023-06-01",
                    endDate: "2023-12-31",
                    followUpDate: "2023-07-15",
                    currentProgress: 25,
                    requiredProgress: 50,
                    unit: "km",
                    repetition: "weekly",
                    endTarget: 100,
                    status: "in-progress",
                    lastUpdated: "",
                    subGoals: [
                        {
                            id: 101,
                            name: "Morning Walk",
                            startDate: "2023-06-01",
                            endDate: "2023-12-31",
                            followUpDate: "2023-07-15",
                            currentProgress: 10,
                            requiredProgress: 20,
                            unit: "km",
                            repetition: "weekly",
                            endTarget: 40,
                            status: "in-progress",
                            lastUpdated: ""
                        },
                        {
                            id: 102,
                            name: "Evening Walk",
                            startDate: "2023-06-01",
                            endDate: "2023-12-31",
                            followUpDate: "2023-07-15",
                            currentProgress: 15,
                            requiredProgress: 30,
                            unit: "km",
                            repetition: "weekly",
                            endTarget: 60,
                            status: "in-progress",
                            lastUpdated: ""
                        }
                    ]
                },
                {
                    id: 2,
                    name: "Writing",
                    startDate: "2023-05-15",
                    endDate: "2023-11-15",
                    followUpDate: "2023-06-15",
                    currentProgress: 8,
                    requiredProgress: 10,
                    unit: "pages",
                    repetition: "daily",
                    endTarget: 100,
                    status: "in-progress",
                    lastUpdated: "",
                    subGoals: [
                        {
                            id: 201,
                            name: "Writing Diary",
                            startDate: "2023-05-15",
                            endDate: "2023-11-15",
                            followUpDate: "2023-06-15",
                            currentProgress: 5,
                            requiredProgress: 7,
                            unit: "pages",
                            repetition: "daily",
                            endTarget: 50,
                            status: "in-progress",
                            lastUpdated: ""
                        },
                        {
                            id: 202,
                            name: "Writing Journal",
                            startDate: "2023-05-15",
                            endDate: "2023-11-15",
                            followUpDate: "2023-06-15",
                            currentProgress: 3,
                            requiredProgress: 3,
                            unit: "pages",
                            repetition: "daily",
                            endTarget: 50,
                            status: "completed",
                            lastUpdated: ""
                        }
                    ]
                },
                {
                    id: 3,
                    name: "Reading",
                    startDate: "2023-01-01",
                    endDate: "2023-12-31",
                    followUpDate: "2023-07-01",
                    currentProgress: 3,
                    requiredProgress: 5,
                    unit: "books",
                    repetition: "monthly",
                    endTarget: 12,
                    status: "in-progress",
                    lastUpdated: "",
                    subGoals: []
                },
                {
                    id: 4,
                    name: "Studying",
                    startDate: "2023-04-01",
                    endDate: "2023-10-31",
                    followUpDate: "2023-06-30",
                    currentProgress: 20,
                    requiredProgress: 30,
                    unit: "hours",
                    repetition: "weekly",
                    endTarget: 200,
                    status: "in-progress",
                    lastUpdated: "",
                    subGoals: []
                }
            ];
            
            let logs = [];
            
            // Initialize UI
            updateDateTime();
            setInterval(updateDateTime, 1000);
            renderGoalTable();
            renderLogs();
            
            // Tab functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                });
            });
            
            // Add new goal
            document.getElementById('addGoalBtn').addEventListener('click', function() {
                const newId = goals.length > 0 ? Math.max(...goals.map(g => g.id)) + 1 : 1;
                
                const newGoal = {
                    id: newId,
                    name: "New Goal",
                    startDate: formatDate(new Date()),
                    endDate: formatDate(new Date(new Date().setFullYear(new Date().getFullYear() + 1))),
                    followUpDate: formatDate(new Date(new Date().setMonth(new Date().getMonth() + 1))),
                    currentProgress: 0,
                    requiredProgress: 1,
                    unit: "units",
                    repetition: "weekly",
                    endTarget: 10,
                    status: "pending",
                    lastUpdated: "",
                    subGoals: []
                };
                
                goals.push(newGoal);
                renderGoalTable();
            });
            
            // Export data
            document.getElementById('exportDataBtn').addEventListener('click', function() {
                const data = {
                    goals: goals,
                    logs: logs
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'goal-tracker-data.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });
            
            // Import data
            document.getElementById('importDataBtn').addEventListener('click', function() {
                document.getElementById('importFileInput').click();
            });
            
            document.getElementById('importFileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (importedData.goals && importedData.logs) {
                            goals = importedData.goals;
                            logs = importedData.logs;
                            renderGoalTable();
                            renderLogs();
                            alert('Data imported successfully!');
                        } else {
                            alert('Invalid data format');
                        }
                    } catch (error) {
                        alert('Error parsing data file');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            });
            
            // Update date and time display
            function updateDateTime() {
                const now = new Date();
                document.getElementById('currentDate').textContent = "Today's Date: " + now.toLocaleDateString('en-US', { 
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                });
                document.getElementById('currentTime').textContent = "Current Time: " + now.toLocaleTimeString('en-US', {
                    hour: '2-digit', minute: '2-digit', second: '2-digit'
                });
            }
            
            // Format date as YYYY-MM-DD
            function formatDate(date) {
                const d = new Date(date);
                let month = '' + (d.getMonth() + 1);
                let day = '' + d.getDate();
                const year = d.getFullYear();
                
                if (month.length < 2) month = '0' + month;
                if (day.length < 2) day = '0' + day;
                
                return [year, month, day].join('-');
            }
            
            // Calculate time remaining
            function calculateTimeRemaining(endDate) {
                const end = new Date(endDate);
                const now = new Date();
                const diff = end - now;
                
                if (diff <= 0) return "Time's up!";
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                return `${days}d ${hours}h`;
            }
            
            // Calculate available time
            function calculateAvailableTime(startDate, endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const diff = end - start;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                return `${days}d ${hours}h`;
            }
            
            // Calculate progress rank (1-10)
            function calculateProgressRank(currentProgress, requiredProgress, endTarget) {
                if (currentProgress >= endTarget) return 10;
                
                const progressPercentage = (currentProgress / requiredProgress) * 100;
                
                if (progressPercentage >= 100) return 9;
                if (progressPercentage >= 90) return 8;
                if (progressPercentage >= 80) return 7;
                if (progressPercentage >= 70) return 6;
                if (progressPercentage >= 60) return 5;
                if (progressPercentage >= 50) return 4;
                if (progressPercentage >= 40) return 3;
                if (progressPercentage >= 30) return 2;
                if (progressPercentage >= 20) return 1;
                return 0;
            }
            
            // Render goal table
            function renderGoalTable() {
                const tbody = document.querySelector('#goalTable tbody');
                tbody.innerHTML = '';
                
                goals.forEach(goal => {
                    // Main goal row
                    const mainRow = document.createElement('tr');
                    mainRow.dataset.id = goal.id;
                    mainRow.innerHTML = `
                        <td>
                            <button class="expand-btn button-small" data-id="${goal.id}">${goal.subGoals.length > 0 ? '−' : '+'}</button>
                            <span contenteditable="true" class="goal-name">${goal.name}</span>
                        </td>
                        <td><input type="date" value="${goal.startDate}"></td>
                        <td><input type="date" value="${goal.endDate}"></td>
                        <td><input type="date" value="${goal.followUpDate}"></td>
                        <td>
                            <div class="progress-input">
                                <input type="number" value="${goal.currentProgress}" class="progress-value">
                                <button class="update-progress button-small">Update</button>
                            </div>
                        </td>
                        <td><input type="number" value="${goal.requiredProgress}"></td>
                        <td>
                            <select class="unit-select">
                                <option ${goal.unit === 'km' ? 'selected' : ''}>km</option>
                                <option ${goal.unit === 'miles' ? 'selected' : ''}>miles</option>
                                <option ${goal.unit === 'pages' ? 'selected' : ''}>pages</option>
                                <option ${goal.unit === 'books' ? 'selected' : ''}>books</option>
                                <option ${goal.unit === 'hours' ? 'selected' : ''}>hours</option>
                                <option ${goal.unit === 'units' ? 'selected' : ''}>units</option>
                            </select>
                        </td>
                        <td>
                            <select class="repetition-select">
                                <option ${goal.repetition === 'daily' ? 'selected' : ''}>daily</option>
                                <option ${goal.repetition === 'weekly' ? 'selected' : ''}>weekly</option>
                                <option ${goal.repetition === 'monthly' ? 'selected' : ''}>monthly</option>
                                <option ${goal.repetition === 'half-yearly' ? 'selected' : ''}>half-yearly</option>
                                <option ${goal.repetition === 'yearly' ? 'selected' : ''}>yearly</option>
                            </select>
                        </td>
                        <td><input type="number" value="${goal.endTarget}"></td>
                        <td class="available-time">${calculateAvailableTime(goal.startDate, goal.endDate)}</td>
                        <td class="time-remaining ${new Date(goal.endDate) < new Date() ? 'negative' : 'positive'}">
                            ${calculateTimeRemaining(goal.endDate)}
                        </td>
                        <td>
                            <select class="status-select">
                                <option value="pending" ${goal.status === 'pending' ? 'selected' : ''} class="status-pending">Pending</option>
                                <option value="in-progress" ${goal.status === 'in-progress' ? 'selected' : ''} class="status-in-progress">In Progress</option>
                                <option value="completed" ${goal.status === 'completed' ? 'selected' : ''} class="status-completed">Completed</option>
                                <option value="overdue" ${goal.status === 'overdue' ? 'selected' : ''} class="status-overdue">Overdue</option>
                            </select>
                        </td>
                        <td class="progress-rank rank-${calculateProgressRank(goal.currentProgress, goal.requiredProgress, goal.endTarget)}">
                            ${calculateProgressRank(goal.currentProgress, goal.requiredProgress, goal.endTarget)}
                        </td>
                        <td class="last-updated">${goal.lastUpdated || 'Not updated yet'}</td>
                        <td>
                            <button class="edit-btn button-small">✏️</button>
                            <button class="delete-btn button-small button-danger">🗑️</button>
                        </td>
                    `;
                    
                    tbody.appendChild(mainRow);
                    
                    // Add event listeners to main goal row
                    addRowEventListeners(mainRow, goal);
                    
                    // Sub-goals rows
                    goal.subGoals.forEach(subGoal => {
                        const subRow = document.createElement('tr');
                        subRow.className = 'sub-goal';
                        subRow.dataset.id = subGoal.id;
                        subRow.dataset.parentId = goal.id;
                        subRow.innerHTML = `
                            <td style="padding-left: 40px;">↳ <span contenteditable="true" class="goal-name">${subGoal.name}</span></td>
                            <td><input type="date" value="${subGoal.startDate}"></td>
                            <td><input type="date" value="${subGoal.endDate}"></td>
                            <td><input type="date" value="${subGoal.followUpDate}"></td>
                            <td>
                                <div class="progress-input">
                                    <input type="number" value="${subGoal.currentProgress}" class="progress-value">
                                    <button class="update-progress button-small">Update</button>
                                </div>
                            </td>
                            <td><input type="number" value="${subGoal.requiredProgress}"></td>
                            <td>
                                <select class="unit-select">
                                    <option ${subGoal.unit === 'km' ? 'selected' : ''}>km</option>
                                    <option ${subGoal.unit === 'miles' ? 'selected' : ''}>miles</option>
                                    <option ${subGoal.unit === 'pages' ? 'selected' : ''}>pages</option>
                                    <option ${subGoal.unit === 'books' ? 'selected' : ''}>books</option>
                                    <option ${subGoal.unit === 'hours' ? 'selected' : ''}>hours</option>
                                    <option ${subGoal.unit === 'units' ? 'selected' : ''}>units</option>
                                </select>
                            </td>
                            <td>
                                <select class="repetition-select">
                                    <option ${subGoal.repetition === 'daily' ? 'selected' : ''}>daily</option>
                                    <option ${subGoal.repetition === 'weekly' ? 'selected' : ''}>weekly</option>
                                    <option ${subGoal.repetition === 'monthly' ? 'selected' : ''}>monthly</option>
                                    <option ${subGoal.repetition === 'half-yearly' ? 'selected' : ''}>half-yearly</option>
                                    <option ${subGoal.repetition === 'yearly' ? 'selected' : ''}>yearly</option>
                                </select>
                            </td>
                            <td><input type="number" value="${subGoal.endTarget}"></td>
                            <td class="available-time">${calculateAvailableTime(subGoal.startDate, subGoal.endDate)}</td>
                            <td class="time-remaining ${new Date(subGoal.endDate) < new Date() ? 'negative' : 'positive'}">
                                ${calculateTimeRemaining(subGoal.endDate)}
                            </td>
                            <td>
                                <select class="status-select">
                                    <option value="pending" ${subGoal.status === 'pending' ? 'selected' : ''} class="status-pending">Pending</option>
                                    <option value="in-progress" ${subGoal.status === 'in-progress' ? 'selected' : ''} class="status-in-progress">In Progress</option>
                                    <option value="completed" ${subGoal.status === 'completed' ? 'selected' : ''} class="status-completed">Completed</option>
                                    <option value="overdue" ${subGoal.status === 'overdue' ? 'selected' : ''} class="status-overdue">Overdue</option>
                                </select>
                            </td>
                            <td class="progress-rank rank-${calculateProgressRank(subGoal.currentProgress, subGoal.requiredProgress, subGoal.endTarget)}">
                                ${calculateProgressRank(subGoal.currentProgress, subGoal.requiredProgress, subGoal.endTarget)}
                            </td>
                            <td class="last-updated">${subGoal.lastUpdated || 'Not updated yet'}</td>
                            <td>
                                <button class="edit-btn button-small">✏️</button>
                                <button class="delete-btn button-small button-danger">🗑️</button>
                            </td>
                        `;
                        
                        tbody.appendChild(subRow);
                        
                        // Add event listeners to sub-goal row
                        addRowEventListeners(subRow, subGoal);
                    });
                });
            }
            
            // Add event listeners to a row
            function addRowEventListeners(row, goalData) {
                // Update progress
                row.querySelector('.update-progress')?.addEventListener('click', function() {
                    const timestamp = new Date().toLocaleString();
                    const progressValue = row.querySelector('.progress-value').value;
                    const goalName = row.querySelector('.goal-name').textContent;
                    const unit = row.querySelector('.unit-select').value;
                    
                    // Update last updated
                    row.querySelector('.last-updated').textContent = timestamp;
                    
                    // Update goal data
                    const goal = findGoalById(goalData.id);
                    if (goal) {
                        goal.currentProgress = parseInt(progressValue);
                        goal.lastUpdated = timestamp;
                        
                        // Update status if needed
                        if (goal.currentProgress >= goal.endTarget) {
                            goal.status = 'completed';
                            row.querySelector('.status-select').value = 'completed';
                        }
                        
                        // Update progress rank
                        const rank = calculateProgressRank(goal.currentProgress, goal.requiredProgress, goal.endTarget);
                        row.querySelector('.progress-rank').textContent = rank;
                        row.querySelector('.progress-rank').className = `progress-rank rank-${rank}`;
                        
                        // Add to log
                        logs.unshift({
                            goalId: goal.id,
                            goalName: goalName,
                            progress: `${progressValue} ${unit}`,
                            timestamp: timestamp,
                            action: 'progress-update'
                        });
                        
                        renderLogs();
                    }
                });
                
                // Expand/collapse sub-goals
                row.querySelector('.expand-btn')?.addEventListener('click', function() {
                    const goalId = parseInt(this.dataset.id);
                    const goal = findGoalById(goalId);
                    
                    if (goal) {
                        if (this.textContent === '+') {
                            // Add sub-goal
                            const newSubGoalId = goal.subGoals.length > 0 ? Math.max(...goal.subGoals.map(sg => sg.id)) + 1 : goalId * 100 + 1;
                            
                            const newSubGoal = {
                                id: newSubGoalId,
                                name: "New Sub-Goal",
                                startDate: goal.startDate,
                                endDate: goal.endDate,
                                followUpDate: goal.followUpDate,
                                currentProgress: 0,
                                requiredProgress: 1,
                                unit: goal.unit,
                                repetition: goal.repetition,
                                endTarget: Math.floor(goal.endTarget / (goal.subGoals.length + 1)),
                                status: "pending",
                                lastUpdated: ""
                            };
                            
                            goal.subGoals.push(newSubGoal);
                            this.textContent = '−';
                        } else {
                            // Remove all sub-goals
                            goal.subGoals = [];
                            this.textContent = '+';
                        }
                        
                        renderGoalTable();
                    }
                });
                
                // Delete row
                row.querySelector('.delete-btn')?.addEventListener('click', function() {
                    if (confirm('Are you sure you want to delete this goal?')) {
                        if (row.classList.contains('sub-goal')) {
                            // Delete sub-goal
                            const parentId = parseInt(row.dataset.parentId);
                            const subGoalId = parseInt(row.dataset.id);
                            const parentGoal = findGoalById(parentId);
                            
                            if (parentGoal) {
                                parentGoal.subGoals = parentGoal.subGoals.filter(sg => sg.id !== subGoalId);
                            }
                        } else {
                            // Delete main goal
                            const goalId = parseInt(row.dataset.id);
                            goals = goals.filter(g => g.id !== goalId);
                        }
                        
                        renderGoalTable();
                    }
                });
                
                // Edit row (highlight)
                row.querySelector('.edit-btn')?.addEventListener('click', function() {
                    row.style.backgroundColor = '#fffde7';
                    setTimeout(() => {
                        row.style.backgroundColor = '';
                    }, 2000);
                });
                
                // Update fields when changed
                const updateFields = ['startDate', 'endDate', 'followUpDate', 'requiredProgress', 'endTarget'];
                updateFields.forEach(field => {
                    const input = row.querySelector(`input[type="${field === 'requiredProgress' || field === 'endTarget' ? 'number' : 'date'}"]`);
                    if (input) {
                        input.addEventListener('change', function() {
                            const goal = findGoalById(goalData.id);
                            if (goal) {
                                goal[field] = field === 'requiredProgress' || field === 'endTarget' ? 
                                    parseInt(this.value) : this.value;
                                
                                // Update time calculations if dates changed
                                if (field === 'startDate' || field === 'endDate') {
                                    row.querySelector('.available-time').textContent = calculateAvailableTime(
                                        goal.startDate, goal.endDate
                                    );
                                    row.querySelector('.time-remaining').textContent = calculateTimeRemaining(goal.endDate);
                                    row.querySelector('.time-remaining').className = `time-remaining ${
                                        new Date(goal.endDate) < new Date() ? 'negative' : 'positive'
                                    }`;
                                }
                                
                                // Update progress rank if targets changed
                                if (field === 'requiredProgress' || field === 'endTarget') {
                                    const rank = calculateProgressRank(
                                        goal.currentProgress, 
                                        goal.requiredProgress, 
                                        goal.endTarget
                                    );
                                    row.querySelector('.progress-rank').textContent = rank;
                                    row.querySelector('.progress-rank').className = `progress-rank rank-${rank}`;
                                }
                            }
                        });
                    }
                });
                
                // Update select fields
                const selectFields = ['unit', 'repetition', 'status'];
                selectFields.forEach(field => {
                    const select = row.querySelector(`.${field}-select`);
                    if (select) {
                        select.addEventListener('change', function() {
                            const goal = findGoalById(goalData.id);
                            if (goal) {
                                goal[field] = field === 'status' ? this.value : this.options[this.selectedIndex].text;
                            }
                        });
                    }
                });
                
                // Update goal name
                const nameField = row.querySelector('.goal-name');
                if (nameField) {
                    nameField.addEventListener('blur', function() {
                        const goal = findGoalById(goalData.id);
                        if (goal) {
                            goal.name = this.textContent;
                        }
                    });
                }
            }
            
            // Find goal by ID
            function findGoalById(id) {
                for (const goal of goals) {
                    if (goal.id === id) return goal;
                    for (const subGoal of goal.subGoals) {
                        if (subGoal.id === id) return subGoal;
                    }
                }
                return null;
            }
            
            // Render logs
            function renderLogs() {
                const container = document.getElementById('progressLogContainer');
                container.innerHTML = '';
                
                if (logs.length === 0) {
                    container.innerHTML = '<p>No log entries yet.</p>';
                    return;
                }
                
                logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';
                    
                    logEntry.innerHTML = `
                        <div>
                            <span class="log-goal">${log.goalName}</span>
                            <span class="log-details">${log.progress}</span>
                        </div>
                        <div class="log-timestamp">${log.timestamp}</div>
                    `;
                    
                    container.appendChild(logEntry);
                });
            }
        });
    </script>
</body>
</html>
